---
import fs from "node:fs";
import path from "node:path";
import { execSync } from "node:child_process";
import { footerConfig, profileConfig } from "@/config";
import { url } from "@/utils/url-utils";

const currentYear = new Date().getFullYear();

/* ========= FooterConfig.html（0） ========= */

let customFooterHtml = "";
if (footerConfig.enable) {
	try {
		const footerConfigPath = path.join(
			process.cwd(),
			"src",
			"config",
			"FooterConfig.html",
		);
		customFooterHtml = fs.readFileSync(footerConfigPath, "utf-8");
		customFooterHtml = customFooterHtml
			.replace(/<!--[\s\S]*?-->/g, "")
			.trim();
	} catch (error) {
		console.warn("FooterConfig.html 文件读取失败:", error.message);
	}
}

/* ========= Git 构建信息 ========= */

let commitHash = "unknown";
let buildDate = "unknown";

try {
	commitHash = execSync("git rev-parse --short=7 HEAD")
		.toString()
		.trim();

	const date = new Date();
	const year = date.getFullYear();
	const month = String(date.getMonth() + 1).padStart(2, "0");
	const day = String(date.getDate()).padStart(2, "0");
	const hours = String(date.getHours()).padStart(2, "0");
	const minutes = String(date.getMinutes()).padStart(2, "0");
	const seconds = String(date.getSeconds()).padStart(2, "0");

	buildDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
} catch (e) {
	console.warn("Failed to get git info", e);
}
---

<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-4 md:mx-32"></div>

<div class="card-base mx-auto rounded-xl mt-4 mb-4 max-w-lg">
	<div class="transition text-50 text-sm text-center p-6">

		&copy; <span>2024 - {currentYear}</span>
		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href="https://blog.quiyu.cn"
		>
			{profileConfig.name}
		</a>
		，采用
		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
		>
			CC BY-NC-SA 4.0
		</a>
		许可

		<br />

		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href={url("rss.xml")}
		>
			RSS
		</a>
		/
		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href={url("sitemap-index.xml")}
		>
			网站地图
		</a>

		<br />

		由
		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href="https://astro.build"
		>
			Astro
		</a>
		和
		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href="https://github.com/CuteLeaf/Firefly"
		>
			Firefly
		</a>
		强力驱动

		<br />

		本网站代码
		<a
			class="transition link text-[var(--primary)] font-medium"
			target="_blank"
			href="https://github.com/qiuyuxc/Firefly"
		>
			已开源
		</a>
		<a
			class="transition link text-black/30 dark:text-white/30 hover:text-[var(--primary)] text-xs ml-1"
			target="_blank"
			href={`https://github.com/qiuyuxc/Firefly/commit/${commitHash}`}
		>
			({commitHash} @ {buildDate})
		</a>

		<br />

		<!-- 固定 Cloudflare Pages -->
		<div class="flex items-center justify-center gap-1 mt-1">
			<span class="text-black/30 dark:text-white/30 text-xs">
				访问节点：
			</span>
			<img
				src="/assets/cdn/cf.svg"
				alt="Cloudflare Pages"
				title="Deployed on Cloudflare Pages"
				class="h-4"
			/>
		</div>

	</div>
</div>


<script defer src="https://cloud.umami.is/script.js" data-website-id="010a1dd3-7465-4fa7-b73b-09b6ad6efe85"></script>